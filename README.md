# xinlang_optional_stock
使用油猴脚本, 通过新浪 页面API, 自动导入自选股

## 功能介绍
这是一个用于油猴插件的JavaScript脚本，可以批量导入自选股到新浪财经的自选分组中。

### 已实现的功能
1. **用户界面**
   - 固定在页面右下角的触发按钮
   - 响应式模态框设计
   - 分组选择下拉菜单（支持自动刷新和手动刷新）
   - 股票代码文本输入区域
   - 进度条和状态显示

2. **核心功能**
   - 自动获取用户的自选分组列表
   - 支持多种股票代码格式（如 600000.SH, 000001.SZ）
   - 批量导入股票到指定分组
   - 自动转换股票代码格式以适配新浪接口

3. **用户体验**
   - 实时进度显示
   - 成功/错误状态提示
   - 网络错误处理
   - 导入结果统计
   - 分组列表自动刷新（每次打开模态框时自动更新）

## 安装和使用说明

1. 安装油猴插件（Tampermonkey）
2. 创建新脚本并将worker.js的内容复制进去
3. 访问新浪财经网站（https://finance.sina.com.cn/）
4. 点击页面右下角的"导入自选股"按钮
5. 选择目标分组并输入股票代码列表
6. 点击"导入"开始批量导入

## 股票代码格式支持

脚本支持多种股票代码格式：
- 标准格式：600000.SH（上交所）、000001.SZ（深交所）
- 简化格式：600000（自动识别为上交所）、000001（自动识别为深交所）

## API接口

脚本使用了新浪财经的两个公开API接口：
1. 获取自选分组列表：`PortfolioService.getPyList`
2. 添加股票到分组：`HoldV2Service.appendSymbol`

这些接口会自动使用浏览器中的Cookie进行身份验证，无需额外登录。

## 注意事项

1. 脚本仅在新浪财经网站生效
2. 脚本使用并发导入（最多5个并发请求）以提高导入速度
3. 如果遇到导入失败的情况，可以重新尝试导入失败的股票
4. 确保您已登录新浪财经账户以正常使用此工具
5. 过高的并发可能导致请求被服务器限制，请根据网络情况调整

## 技术特性

- 使用GM_xmlhttpRequest进行跨域请求
- JSONP响应解析
- 利用浏览器自动携带的Cookie进行身份验证
- 并发导入（最多5个并发请求）以提高导入速度
- 分组列表自动刷新（每次打开模态框时自动加载最新分组）
- 完善的错误处理和用户反馈机制
- 实时进度跟踪和统计信息显示